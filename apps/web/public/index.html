<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agent Swarm Status</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "ui-sans-serif", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>
    <link rel="stylesheet" href="css/dashboard.css" />
  </head>
  <body class="min-h-screen bg-zinc-950 text-zinc-100 antialiased">
    <canvas id="bg-canvas" class="fixed inset-0 z-0 pointer-events-none opacity-30"></canvas>

    <div class="relative z-10">
      <div class="mx-auto max-w-7xl px-5 pb-16 pt-8 sm:px-8 lg:px-10">
        <header class="relative overflow-hidden rounded-2xl border border-zinc-800 bg-zinc-900 p-6 shadow-lg shadow-white/10 sm:p-8">
          <div class="relative flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.2em] text-zinc-400">AI Swarm Control Plane</p>
              <h1 class="mt-2 text-3xl font-semibold tracking-tight text-white sm:text-4xl">Queue &amp; Run Status Dashboard</h1>
              <p class="mt-3 text-sm text-zinc-400 sm:text-base">Live visibility into orchestrator queue state and runner outcomes.</p>
            </div>
            <div class="flex w-full flex-col gap-3 lg:max-w-lg lg:items-end">
              <button
                id="settings-open-button"
                type="button"
                class="inline-flex items-center gap-2 self-start rounded-lg border border-zinc-700 bg-black px-4 py-2 text-xs font-semibold uppercase tracking-[0.16em] text-zinc-200 transition hover:border-zinc-500 hover:text-white lg:self-end"
              >
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path
                    d="M9.75 4.5h4.5l.85 2.12c.3.11.6.24.88.39l2.2-.86 2.25 3.9-1.74 1.58c.03.33.03.66 0 1l1.74 1.58-2.25 3.9-2.2-.86c-.28.15-.58.28-.88.39l-.85 2.12h-4.5l-.85-2.12a7.96 7.96 0 0 1-.88-.39l-2.2.86-2.25-3.9L5.4 12.5a7.1 7.1 0 0 1 0-1L3.66 9.92l2.25-3.9 2.2.86c.28-.15.58-.28.88-.39L9.75 4.5Z"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linejoin="round"
                  />
                  <circle cx="12" cy="12" r="2.6" stroke="currentColor" stroke-width="1.5" />
                </svg>
                Settings
              </button>
              <div class="grid w-full gap-3 sm:grid-cols-2">
                <div class="rounded-xl border border-zinc-800 bg-black px-4 py-3 shadow-md shadow-white/5">
                  <p class="text-[11px] font-semibold uppercase tracking-[0.18em] text-zinc-500">Target Repository</p>
                  <p id="target-repo" class="mt-1 text-sm font-semibold text-white sm:text-base">Unknown / Unknown</p>
                </div>
                <div class="rounded-xl border border-zinc-800 bg-black px-4 py-3 shadow-md shadow-white/5">
                  <p class="text-[11px] font-semibold uppercase tracking-[0.18em] text-zinc-500">Last Refresh</p>
                  <p id="last-refresh" class="mt-1 text-sm font-medium text-zinc-200 sm:text-base">Waiting for data...</p>
                </div>
              </div>
            </div>
          </div>
        </header>

        <div id="settings-modal" class="fixed inset-0 z-20 hidden">
          <div id="settings-backdrop" class="absolute inset-0 bg-black/70"></div>
          <aside
            role="dialog"
            aria-modal="true"
            aria-labelledby="settings-title"
            class="absolute right-0 top-0 h-full w-full max-w-md border-l border-zinc-800 bg-zinc-950 p-5 shadow-2xl shadow-black/80 sm:p-6"
          >
            <div class="flex items-center justify-between">
              <h2 id="settings-title" class="text-lg font-semibold tracking-tight text-white">Dashboard Settings</h2>
              <button
                id="settings-close-button"
                type="button"
                class="rounded-lg border border-zinc-700 bg-black px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.12em] text-zinc-300 transition hover:border-zinc-500 hover:text-white"
              >
                Close
              </button>
            </div>
            <p class="mt-2 text-sm text-zinc-400">Update local `.agent-swarm.yml` and `.env` configuration.</p>
            <div class="mt-4 rounded-xl border border-zinc-800 bg-black/60 p-3">
              <p class="text-xs font-semibold uppercase tracking-[0.16em] text-zinc-300">Configure via GUI</p>
              <ul class="mt-2 space-y-1 text-xs text-zinc-400">
                <li><span class="font-semibold text-zinc-200">Target Owner:</span> Use the organization or username slug (e.g., `openai`).</li>
                <li><span class="font-semibold text-zinc-200">Target Repo:</span> Use the repository name slug (e.g., `whisper`).</li>
                <li><span class="font-semibold text-zinc-200">Important:</span> Do not paste full URLs into these fields.</li>
              </ul>
            </div>

            <form id="settings-form" class="mt-5 space-y-4">
              <label class="block">
                <span class="mb-1 block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400">Target Owner</span>
                <input
                  id="settings-target-owner"
                  name="targetOwner"
                  type="text"
                  required
                  autocomplete="off"
                  placeholder="openai"
                  class="w-full rounded-lg border border-zinc-700 bg-black px-3 py-2 text-sm text-white outline-none transition focus:border-zinc-500"
                />
              </label>
              <label class="block">
                <span class="mb-1 block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400">Target Repo</span>
                <input
                  id="settings-target-repo"
                  name="targetRepo"
                  type="text"
                  required
                  autocomplete="off"
                  placeholder="whisper"
                  class="w-full rounded-lg border border-zinc-700 bg-black px-3 py-2 text-sm text-white outline-none transition focus:border-zinc-500"
                />
              </label>
              <label class="block">
                <span class="mb-1 block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400">Project V2 Number</span>
                <input
                  id="settings-project-number"
                  name="projectNumber"
                  type="number"
                  required
                  min="1"
                  step="1"
                  placeholder="7"
                  class="w-full rounded-lg border border-zinc-700 bg-black px-3 py-2 text-sm text-white outline-none transition focus:border-zinc-500"
                />
              </label>
              <label class="block">
                <span class="mb-1 block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400">GitHub PAT</span>
                <input
                  id="settings-github-token"
                  name="githubToken"
                  type="password"
                  autocomplete="new-password"
                  placeholder="Enter token to set"
                  class="w-full rounded-lg border border-zinc-700 bg-black px-3 py-2 text-sm text-white outline-none transition focus:border-zinc-500"
                />
              </label>
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <label class="block">
                  <span class="mb-1 block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400">Max Executors</span>
                  <input
                    id="settings-max-executors"
                    name="maxExecutors"
                    type="number"
                    required
                    min="1"
                    step="1"
                    class="w-full rounded-lg border border-zinc-700 bg-black px-3 py-2 text-sm text-white outline-none transition focus:border-zinc-500"
                  />
                </label>
                <label class="block">
                  <span class="mb-1 block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400">Max Reviewers</span>
                  <input
                    id="settings-max-reviewers"
                    name="maxReviewers"
                    type="number"
                    required
                    min="1"
                    step="1"
                    class="w-full rounded-lg border border-zinc-700 bg-black px-3 py-2 text-sm text-white outline-none transition focus:border-zinc-500"
                  />
                </label>
              </div>
              <div class="rounded-xl border border-zinc-800 bg-black/60 p-3">
                <p class="text-xs font-semibold uppercase tracking-[0.16em] text-zinc-300">Notifications</p>
                <label class="mt-2 flex items-start gap-2">
                  <input
                    id="settings-sound-needs-human-approval"
                    type="checkbox"
                    class="mt-0.5 h-4 w-4 accent-zinc-200"
                  />
                  <span class="block">
                    <span class="block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400">Needs Human Approval sound</span>
                    <span class="mt-1 block text-xs text-zinc-500">
                      Play a sound when a reviewer moves a task to <span class="font-semibold text-zinc-200">Needs Human Approval</span>.
                      (Most browsers require one click/keypress to enable audio.)
                    </span>
                  </span>
                </label>
              </div>
              <div
                id="settings-message"
                class="hidden rounded-lg border px-3 py-2 text-sm"
                role="status"
                aria-live="polite"
              ></div>
              <div class="flex items-center justify-end gap-3 pt-2">
                <button
                  id="settings-cancel-button"
                  type="button"
                  class="rounded-lg border border-zinc-700 bg-black px-4 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-zinc-300 transition hover:border-zinc-500 hover:text-white"
                >
                  Cancel
                </button>
                <button
                  id="settings-save-button"
                  type="submit"
                  class="rounded-lg border border-zinc-200 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-zinc-950 transition hover:bg-zinc-200 disabled:cursor-not-allowed disabled:opacity-60"
                >
                  Save Settings
                </button>
              </div>
            </form>
          </aside>
        </div>

        <div id="error-banner" class="mt-5 hidden rounded-xl border border-zinc-700 bg-zinc-900 px-4 py-3 text-sm font-medium text-zinc-200 shadow-md shadow-white/5"></div>

        <section
          id="seal-controls"
          class="mt-5 hidden rounded-2xl border border-zinc-800 bg-zinc-900 p-5 shadow-lg shadow-white/10"
        >
          <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.2em] text-zinc-400">Sprint Verification</p>
              <p id="seal-verification-prompt" class="mt-2 text-sm text-zinc-300">
                Sprint pending human verification. Edit issues in GitHub, then Seal to begin.
              </p>
              <p class="mt-2 text-xs text-zinc-500">
                Sprint: <span id="seal-sprint" class="font-semibold text-zinc-200">N/A</span>
              </p>
            </div>
            <button
              id="seal-sprint-button"
              type="button"
              class="inline-flex w-full items-center justify-center gap-2 rounded-lg border border-zinc-200 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-zinc-950 transition hover:bg-zinc-200 disabled:cursor-not-allowed disabled:opacity-60 sm:w-auto"
            >
              <span
                id="seal-sprint-spinner"
                class="hidden h-3 w-3 animate-spin rounded-full border-2 border-zinc-900 border-r-transparent"
                aria-hidden="true"
              ></span>
              <span id="seal-sprint-label">Seal Sprint</span>
            </button>
          </div>
          <div
            id="seal-errors-container"
            class="hidden mt-4 text-red-400 bg-red-900/20 p-4 rounded mb-4 text-sm"
            role="alert"
            aria-live="polite"
          ></div>
        </section>

        <section class="mt-7 rounded-2xl border border-zinc-800 bg-zinc-900 p-6 shadow-lg shadow-white/10">
          <details id="kickoff-details" open class="group">
            <summary class="flex cursor-pointer list-none flex-wrap items-center justify-between gap-4 marker:hidden">
              <div>
                <h2 class="text-xl font-semibold tracking-tight text-white">Sprint Configuration &amp; Kickoff</h2>
                <p class="mt-1 text-sm text-zinc-400">
                  Step 1 saves your high-level sprint goal. Step 2 starts kickoff execution. If tasks already exist, start the runner loop directly.
                </p>
              </div>
              <div class="inline-flex items-center gap-2 rounded-full border border-zinc-800 bg-black px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.16em] text-zinc-400">
                <span class="group-open:hidden">Expand</span>
                <span class="hidden group-open:inline">Collapse</span>
                <svg class="h-4 w-4 transition-transform group-open:rotate-180" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </div>
            </summary>

            <form id="kickoff-form" class="mt-5">
              <label
                for="kickoff-goal"
                class="mb-2 block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400"
              >
                Sprint Goal
              </label>
              <textarea
                id="kickoff-goal"
                name="goal"
                rows="7"
                placeholder="Example: Ship sprint kickoff validation hardening and add tests for claim lease expiration handling."
                class="w-full rounded-xl border border-zinc-700 bg-black px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-zinc-500"
              ></textarea>
              <div class="mt-4 flex flex-wrap items-end gap-4">
                <label class="block w-full sm:max-w-[200px]">
                  <span class="mb-1 block text-xs font-semibold uppercase tracking-[0.16em] text-zinc-400">Sprint</span>
                  <input
                    id="kickoff-sprint"
                    name="sprint"
                    type="text"
                    value="M1"
                    placeholder="M1"
                    autocomplete="off"
                    class="w-full rounded-lg border border-zinc-700 bg-black px-3 py-2 text-sm text-white outline-none transition focus:border-zinc-500"
                  />
                </label>
                <label class="flex w-full items-start gap-2 rounded-lg border border-zinc-800 bg-black/60 px-3 py-2 text-xs text-zinc-300 sm:max-w-xl">
                  <input
                    id="kickoff-require-verification"
                    type="checkbox"
                    class="mt-0.5 h-4 w-4 accent-zinc-200"
                  />
                  <span class="block">
                    <span class="block text-[11px] font-semibold uppercase tracking-[0.14em] text-zinc-300">
                      Pause for human verification before starting sprint
                    </span>
                    <span class="mt-1 block text-xs text-zinc-500">
                      Creates GitHub items, then waits for Seal Sprint.
                    </span>
                  </span>
                </label>
              </div>
              <div id="kickoff-start-workflow-hint" class="mt-3 rounded-lg border border-zinc-800 bg-black px-3 py-2 text-xs text-zinc-400">
                <p class="font-semibold uppercase tracking-[0.16em] text-zinc-300">Start Workflow</p>
                <p class="mt-1">
                  Click <span class="font-semibold text-zinc-200">Start Kickoff Loop (Step 2)</span> to launch kickoff from the GUI. Manual fallback:
                  `python3 -m apps.runner --kickoff --sprint M1 --goal-file ./goal.txt --loop`
                </p>
                <p class="mt-1">
                  Resume existing tasks without kickoff: click <span class="font-semibold text-zinc-200">Start Runner Loop (No Kickoff)</span> or run
                  `python3 -m apps.runner --sprint M1 --loop`
                </p>
              </div>
              <div class="mt-6 flex flex-col gap-5 lg:flex-row lg:items-end">
                <div class="flex flex-col gap-4">
                  <div class="flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center">
                    <button
                      id="kickoff-submit-button"
                      type="submit"
                      class="inline-flex w-full items-center justify-center gap-2 rounded-lg border border-zinc-200 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-zinc-950 transition hover:bg-zinc-200 disabled:cursor-not-allowed disabled:opacity-60 sm:w-auto"
                    >
                      <span
                        id="kickoff-button-spinner"
                        class="hidden h-3 w-3 animate-spin rounded-full border-2 border-zinc-900 border-r-transparent"
                        aria-hidden="true"
                      ></span>
                      <span id="kickoff-button-label">Save Goal (Step 1)</span>
                    </button>
                    <button
                      id="kickoff-start-loop-button"
                      type="button"
                      class="inline-flex w-full items-center justify-center gap-2 rounded-lg border border-zinc-700 bg-black px-4 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-zinc-200 transition hover:border-zinc-500 hover:text-white disabled:cursor-not-allowed disabled:opacity-60 sm:w-auto"
                    >
                      <span
                        id="kickoff-start-loop-spinner"
                        class="hidden h-3 w-3 animate-spin rounded-full border-2 border-zinc-200 border-r-transparent"
                        aria-hidden="true"
                      ></span>
                      <span id="kickoff-start-loop-label">Start Kickoff Loop (Step 2)</span>
                    </button>
                  </div>

                  <div id="kickoff-runner-loop-container" class="flex flex-col gap-2">
                    <span class="text-[10px] font-semibold uppercase tracking-[0.16em] text-zinc-500">Resume existing tasks:</span>
                    <button
                      id="kickoff-start-runner-loop-button"
                      type="button"
                      class="inline-flex w-full items-center justify-center gap-2 rounded-lg border border-zinc-700 bg-black px-4 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-zinc-200 transition hover:border-zinc-500 hover:text-white disabled:cursor-not-allowed disabled:opacity-60 sm:w-auto"
                    >
                      <span
                        id="kickoff-start-runner-loop-spinner"
                        class="hidden h-3 w-3 animate-spin rounded-full border-2 border-zinc-200 border-r-transparent"
                        aria-hidden="true"
                      ></span>
                      <span id="kickoff-start-runner-loop-label">Start Runner Loop (No Kickoff)</span>
                    </button>
                  </div>
                </div>

                <div class="rounded-xl border border-zinc-800 bg-black/40 p-3 lg:ml-auto">
                  <p class="text-[10px] font-semibold uppercase tracking-[0.16em] text-zinc-500">Admin Controls</p>
                  <div class="mt-2 flex flex-wrap items-center gap-3">
                    <button
                      id="kickoff-stop-orchestrators-button"
                      type="button"
                      class="inline-flex flex-1 items-center justify-center gap-2 rounded-lg border border-rose-400/40 bg-rose-500/10 px-4 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-rose-100 transition hover:border-rose-300 hover:text-white disabled:cursor-not-allowed disabled:opacity-60"
                    >
                      <span
                        id="kickoff-stop-orchestrators-spinner"
                        class="hidden h-3 w-3 animate-spin rounded-full border-2 border-rose-100 border-r-transparent"
                        aria-hidden="true"
                      ></span>
                      <span id="kickoff-stop-orchestrators-label">Stop Orchestrators</span>
                    </button>
                    <label
                      class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-black px-3 py-2 text-[11px] font-semibold uppercase tracking-[0.14em] text-zinc-300"
                    >
                      <input id="kickoff-stop-force" type="checkbox" class="h-4 w-4 accent-zinc-200" />
                      Force
                    </label>
                  </div>
                </div>
              </div>
              <p
                id="kickoff-message"
                class="hidden mt-3 w-full rounded-lg border px-3 py-2 text-sm"
                role="status"
                aria-live="polite"
              ></p>
            </form>
          </details>
        </section>

        <main class="mt-7 grid gap-6 xl:grid-cols-5">
          <section class="xl:col-span-3 rounded-2xl border border-zinc-800 bg-zinc-900 p-6 shadow-lg shadow-white/10">
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div>
                <h2 class="text-xl font-semibold tracking-tight text-white">Orchestrator State</h2>
                <p class="mt-1 text-sm text-zinc-400">Current sprint queue with status and dispatch context.</p>
              </div>
              <div class="rounded-full border border-zinc-700 bg-black px-4 py-2 text-sm font-medium text-zinc-300">
                Sprint: <span id="orchestrator-sprint" class="font-semibold text-white">N/A</span>
              </div>
            </div>

            <div id="orchestrator-summary" class="mt-5 flex flex-wrap gap-2"></div>
            <div id="orchestrator-items" class="mt-5 space-y-3"></div>
          </section>

          <section class="xl:col-span-2 rounded-2xl border border-zinc-800 bg-zinc-900 p-6 shadow-lg shadow-white/10">
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div>
                <h2 class="text-xl font-semibold tracking-tight text-white">Runner Ledger</h2>
                <p class="mt-1 text-sm text-zinc-400">Recent executor/reviewer runs and outcomes.</p>
              </div>
              <div
                id="runner-count"
                class="rounded-full border border-zinc-700 bg-black px-3 py-1 text-xs font-semibold uppercase tracking-[0.16em] text-zinc-300"
              >
                0 Runs
              </div>
            </div>

            <div id="runner-runs" class="mono-scrollbar mt-5 h-[500px] space-y-4 overflow-y-auto pr-2"></div>
          </section>
        </main>

        <section class="mt-7 rounded-2xl border border-zinc-800 bg-zinc-900 p-5 shadow-lg shadow-white/10 sm:p-6">
          <div class="flex flex-wrap items-start justify-between gap-4">
            <div>
              <h2 class="text-xl font-semibold tracking-tight text-white">Live Agent Terminals</h2>
              <p class="mt-1 text-sm text-zinc-400">Real-time transcript stream for active runs.</p>
            </div>
            <label
              for="terminal-active-only-toggle"
              class="inline-flex cursor-pointer select-none items-center gap-2 rounded-lg border border-zinc-700 bg-black/50 px-3 py-2 text-xs font-medium text-zinc-300"
            >
              <input
                id="terminal-active-only-toggle"
                type="checkbox"
                class="h-4 w-4 rounded border-zinc-600 bg-zinc-900 text-indigo-500 focus:ring-indigo-400"
                checked
              />
              <span>Only active runs</span>
            </label>
          </div>
          <div
            id="terminal-health-banner"
            class="mt-4 hidden rounded-xl border border-zinc-600 bg-zinc-950/90 px-4 py-3 text-xs text-zinc-200"
          ></div>
          <div class="mt-5">
            <ul id="terminal-tabs" class="mono-scrollbar flex overflow-x-auto border-b border-zinc-800"></ul>
            <div
              id="terminal-window"
              class="mono-scrollbar bg-black text-zinc-300 font-mono text-[10px] sm:text-xs p-4 h-96 overflow-y-auto rounded-b-xl border border-zinc-800 shadow-inner"
            >
              <pre id="terminal-output" class="whitespace-pre text-zinc-300">Waiting for an active run...</pre>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script type="module" src="js/dashboard/index.js"></script>
  </body>
</html>
